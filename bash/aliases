alias ll='ls -l'
alias la='ls -A'
alias l='ls -CF'
alias ll='ls -al'

alias f='fg'
alias tf='terraform'
alias tfw='terraform workspace'

# Ruby related
alias b='bundle exec'
alias gca='git commit -am'
alias s='git status'
alias gpom='git pull origin master'
alias z='zeus'

alias st='open -a /Applications/SourceTree.app .'

alias avr='aws-vault exec --assume-role-ttl=60m'

alias aws-login='aws-vault exec --assume-role-ttl=60m'
alias ag='aws-vault exec gep-dev-admin --'

alias es-dev-ids='ag aws ec2 describe-instances --filter Name=tag:Name,Values=eventstore_dev_instance --query "Reservations[].Instances[].[InstanceId]" --output text'

function es-forward() {
  local env="${1:-dev}"
  local port="2113"
  local localPort="8113"

  local instanceId=$(ag aws ec2 describe-instances --filter Name=tag:Name,Values=eventstore_${env}_instance --query Reservations[].Instances[].[InstanceId] --output text | sort -R | head -n 1)
  local params='{"portNumber":['"${port}"'],"localPortNumber":['"${localPort}"']}'

  echo "Randomly picked the instanceId=$instanceId from $env for forwarding ${params}"
  ag aws ssm start-session --target $instanceId \
                           --document-name AWS-StartPortForwardingSession \
                           --parameters '{"portNumber":["'$port'"],"localPortNumber":["'$localPort'"]}'
}

function es-ssh-tunnel() {
  local env="${1:-dev}"
  local instanceId=$(ag aws ec2 describe-instances --filter Name=tag:Name,Values=eventstore_${env}_instance --query Reservations[].Instances[].[InstanceId] --output text | sort -R | head -n 1)
  echo "Randomly picked the instanceId=$instanceId"

  ag ssh  -L 2113:localhost:2113 ubuntu@${instanceId}

  # Requires this .ssh/config
  # Host i-* mi-*
  #     User ubuntu
  #     ProxyCommand sh -c "aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters 'portNumber=%p'"
  #     IdentityFile ~/.ssh/eventstore_dev
}
